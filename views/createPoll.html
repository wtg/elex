<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
	integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/createGroup.css">
</head>

<body style="background-color: rgb(33,37,46)">
	<div class="container" ng-app="poll" ng-controller="poll_ctrl">

        <div ng-show="create_poll">
            <div class="row">
                <div class="col-xs-12">
                    <h1 class="text-center header">Create a New Poll</h1>
                </div>
            </div>

            <div class="row vote-buttons">
                <div class="col-md-16">
                    <label for="name" class="vote-details">Poll Name:</label>
                    <input type="text" class="form-control" name="name" id="name" ng-model="poll_name"/>

                    <label for="desc" class="vote-details">Description:</label>
                    <textarea type="text" rows="5" class="form-control" name="desc" id="desc" ng-model="poll_description"></textarea>

                    <label for="options" class="vote-details">Poll Options:</label>

                    <div class="row">
                        <div class="col-md-4">
                             <input id="newOption" type="text" class="form-control" placeholder="+  New option" ng-model="newOption" type="text">
                        </div>
                        <button ng-click="add(newOption)" class="btn-default btn-sm">Add</button>


                    </div>
                    <ul id="options">
                        <li ng-repeat="i in poll_options" class="user-details" ng-click="remove($index)">{{i}}</li>
                    </ul>

                    <button class="btn btn-success btn-lg group-button text-center" id="submit" ng-click="submit()">
                        Submit
                    </button>
                    <button type="submit" class="btn btn-danger btn-lg group-button text-center">
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <div ng-show="!create_poll">

            <button ng-click="show_create()" class="btn btn-primary">Create Poll</button>
        </div>

         <div class="row">
            <div class="col-xs-12">
                <h2 class="text-center user-details">
                A Web Science Systems Development Project
                </h2>
                <h2 class="text-center user-details">
                Created by Justin Etzine, Steve Cardozo, Sensen Chen, Sam Fok, and Tristan Villamil
                </h2>
            </div>
        </div>
    </div>



	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
    integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
    crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>

    <script>
        var meeting_id = window.location.href.split('/').pop();

        // remove any trailing '?'s
        if(meeting_id[meeting_id.length - 1] === '?') {
            meeting_id = meeting_id.slice(0, -1);
        }


        var app = angular.module("poll",[]);
        app.controller("poll_ctrl",function($scope,$http){
            var socket = io.connect('http://localhost:3000');
            $scope.poll_name = "";
            $scope.poll_description = "";
            $scope.poll_options = [];
            $scope.username = "";
            $scope.create_poll = false;

            $http.get('/api/getuser').then(function (response) {
                if(response.data.is_authenticated) {
                    $scope.username = response.data.user;
                    socket.emit("join meeting",{ meeting_id: meeting_id, username: $scope.username, is_admin: true });
                    console.log($scope.username + " joined meeting");
                }
            })

            $scope.add = function(item) {

                if(($scope.poll_options).indexOf(item) > -1){
//                      alert("already contains")
                }
                else {
                    $scope.poll_options.push(item);
                    $scope.newOption = "";
                }
            };

            $scope.remove = function(index) {
                $scope.poll_options.splice(index, 1);
            };

            socket.on("invalid")


            $scope.toggle_create = function(){
                $scope.create_poll = !$scope.create_poll;
            }


            $scope.submit = function(){
                socket.emit("create poll", {name: $scope.poll_name, description: $scope.poll_description, options: $scope.poll_options, username: $scope.username});
            }

        });
    </script>
</body>
</html>
